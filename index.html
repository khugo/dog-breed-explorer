<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Dog Breed Explorer</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, sans-serif;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            min-height: 100vh;
            display: flex;
            align-items: center;
            justify-content: center;
            padding: 20px;
        }

        .container {
            background: white;
            border-radius: 20px;
            box-shadow: 0 20px 40px rgba(0, 0, 0, 0.1);
            padding: 40px;
            text-align: center;
            max-width: 500px;
            width: 100%;
            transition: all 0.4s ease-in-out;
        }

        .container.compact {
            padding: 30px;
        }

        .container.compact .breed-display {
            display: none;
        }

        .container.compact .random-btn {
            margin-top: 0;
        }

        h1 {
            color: #333;
            margin-bottom: 30px;
            font-size: 2.5em;
            font-weight: 700;
        }

        .random-btn {
            background: linear-gradient(45deg, #667eea, #764ba2);
            color: white;
            border: none;
            padding: 15px 30px;
            font-size: 18px;
            border-radius: 50px;
            cursor: pointer;
            transition: all 0.3s ease;
            margin-top: 30px;
            font-weight: 600;
        }

        .random-btn:hover {
            transform: translateY(-2px);
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        .breed-display {
            opacity: 0;
            visibility: hidden;
            transform: translateY(20px);
            transition: all 0.3s ease-in-out;
            display: flex;
            flex-direction: column;
        }

        .breed-display.show {
            opacity: 1;
            visibility: visible;
            transform: translateY(0);
        }

        .breed-name {
            font-size: 2em;
            font-weight: 700;
            color: #333;
            margin-bottom: 10px;
        }

        .breed-finnish-name {
            font-size: 1.1em;
            font-weight: 400;
            color: #666;
            margin-bottom: 20px;
        }

        .breed-description {
            font-size: 1.1em;
            color: #666;
            margin-bottom: 20px;
            line-height: 1.5;
            max-width: 400px;
            margin-left: auto;
            margin-right: auto;
            min-height: 60px;
        }

        .breed-image {
            height: 300px;
            object-fit: cover;
            border-radius: 15px;
            margin-bottom: 20px;
            box-shadow: 0 10px 20px rgba(0, 0, 0, 0.1);
            transition: opacity 0.3s ease;
        }

        .breed-image.image-loading {
            background: #e5e5e5;
        }

        .akc-link {
            display: inline-block;
            background: #f8f9fa;
            color: #667eea;
            text-decoration: none;
            padding: 12px 25px;
            border-radius: 25px;
            font-weight: 600;
            border: 2px solid #667eea;
            transition: all 0.3s ease;
        }

        .akc-link:hover {
            background: #667eea;
            color: white;
            transform: translateY(-1px);
        }

        .loading {
            display: inline-block;
            width: 20px;
            height: 20px;
            border: 3px solid rgba(102, 126, 234, 0.3);
            border-radius: 50%;
            border-top-color: #667eea;
            animation: spin 1s ease-in-out infinite;
            margin-left: 10px;
        }

        @keyframes spin {
            to { transform: rotate(360deg); }
        }

        .random-btn:disabled {
            opacity: 0.6;
            cursor: not-allowed;
            transform: none;
        }

        .random-btn:disabled:hover {
            transform: none;
            box-shadow: 0 10px 25px rgba(102, 126, 234, 0.3);
        }

        @media (max-width: 600px) {
            .container {
                padding: 30px 20px;
            }
            
            h1 {
                font-size: 2em;
            }
            
            .breed-image {
                height: 250px;
            }
        }
    </style>
</head>
<body>
    <div class="container compact">
        <h1>üêï Dog Breed Explorer</h1>
        
        <div id="breedDisplay" class="breed-display">
            <h2 id="breedName" class="breed-name"></h2>
            <div id="breedFinnishName" class="breed-finnish-name"></div>
            <img id="breedImage" class="breed-image" height="300" alt="Dog breed" />
            <p id="breedDescription" class="breed-description"></p>
            <a id="akcLink" class="akc-link" target="_blank">Visit AKC Page</a>
            <p id="breedCounter" style="color: #666; font-size: 0.9em; margin-top: 15px;"></p>
        </div>
        
        <button class="random-btn" id="randomBtn" onclick="getRandomBreed()">
            Get Random Breed
            <span class="loading" id="loadingSpinner" style="display: none;"></span>
        </button>
    </div>

    <script>
        let dogBreeds = [];
        let remainingBreeds = [];
        let isLoading = true;

        // Fisher-Yates shuffle algorithm
        function shuffleArray(array) {
            const shuffled = [...array];
            for (let i = shuffled.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [shuffled[i], shuffled[j]] = [shuffled[j], shuffled[i]];
            }
            return shuffled;
        }

        // Initialize breeds for no-duplicate selection
        function initializeBreeds() {
            remainingBreeds = shuffleArray(dogBreeds);
            console.log(`Initialized ${remainingBreeds.length} breeds for selection`);
            updateBreedCounter();
        }

        // Update breed counter display
        function updateBreedCounter() {
            const counter = document.getElementById('breedCounter');
            if (dogBreeds.length > 0) {
                const seen = dogBreeds.length - remainingBreeds.length;
                counter.textContent = `${seen} of ${dogBreeds.length} breeds seen`;
            }
        }

        // Load breed data from JSON file
        async function loadBreeds() {
            const button = document.getElementById('randomBtn');
            const spinner = document.getElementById('loadingSpinner');
            
            try {
                button.disabled = true;
                button.innerHTML = 'Loading Breeds... <span class="loading"></span>';
                
                const response = await fetch('breeds.json');
                dogBreeds = await response.json();
                console.log(`Loaded ${dogBreeds.length} dog breeds`);
                
                button.disabled = false;
                button.innerHTML = 'Get Random Breed';
                isLoading = false;
                initializeBreeds();
                
            } catch (error) {
                console.error('Failed to load breed data:', error);
                // Fallback to a few breeds if JSON fails to load
                dogBreeds = [
                    {
                        name: "Golden Retriever",
                        akcLink: "https://www.akc.org/dog-breeds/golden-retriever/",
                        imageUrl: "https://www.akc.org/wp-content/uploads/2017/11/Golden-Retriever-standing-outdoors.jpg",
                        description: "Friendly, intelligent, devoted"
                    }
                ];
                
                button.disabled = false;
                button.innerHTML = 'Get Random Breed';
                isLoading = false;
                initializeBreeds();
            }
        }

        function getRandomBreed() {
            if (isLoading || dogBreeds.length === 0) {
                alert('Breeds are still loading, please try again in a moment!');
                return;
            }

            // If no breeds remaining, reshuffle all breeds
            if (remainingBreeds.length === 0) {
                console.log('All breeds seen! Reshuffling...');
                initializeBreeds();
            }

            // Pop the next breed from the shuffled array
            const selectedBreed = remainingBreeds.pop();
            console.log(`Selected ${selectedBreed.name}, ${remainingBreeds.length} breeds remaining`);
            
            // Update display elements
            document.getElementById('breedName').textContent = selectedBreed.name;
            
            // Update Finnish name with flag emoji if available
            const finnishNameElement = document.getElementById('breedFinnishName');
            if (selectedBreed.finnishName) {
                finnishNameElement.textContent = `üá´üáÆ ${selectedBreed.finnishName}`;
                finnishNameElement.style.display = 'block';
            } else {
                finnishNameElement.style.display = 'none';
            }
            
            // Clear old image and show loading state immediately
            const imageElement = document.getElementById('breedImage');
            imageElement.src = '';
            imageElement.classList.add('image-loading');
            imageElement.alt = selectedBreed.name;
            
            // Set up event handlers before loading new image
            imageElement.onload = function() {
                imageElement.classList.remove('image-loading');
            };
            imageElement.onerror = function() {
                imageElement.classList.remove('image-loading');
            };
            
            // Load new image
            imageElement.src = selectedBreed.imageUrl;
            document.getElementById('breedDescription').textContent = selectedBreed.description || 'No description available';
            document.getElementById('akcLink').href = selectedBreed.akcLink;
            
            // Update counter and show the breed display with animation
            updateBreedCounter();
            
            // Remove compact class to expand container and show breed display
            const container = document.querySelector('.container');
            container.classList.remove('compact');
            
            const displayElement = document.getElementById('breedDisplay');
            displayElement.classList.add('show');
        }

        // Load breeds when page loads
        document.addEventListener('DOMContentLoaded', loadBreeds);
    </script>
</body>
</html>